<!DOCTYPE html>
<html>
<head>
<title>Minecraft Enchantment Simulator v1.6</title>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="storage.js"></script>
<script type="text/javascript" src="iterator.js"></script>
<script type="text/javascript" src="tools.js"></script>
<script type="text/javascript" src="collection.js"></script>
<script type="text/javascript" src="enchantments.js"></script>
<script type="text/javascript" src="page.js"></script>
<script type="text/javascript" src="chart.js"></script>
<script type="text/javascript" src="mc.js"></script>

<script type="text/javascript">
var _storage = makeStorage();
var _tools = makeTools();
var _page = makePage( _storage, _tools );

$(document).ready(function()
{
	_page.setInitialValues();
	simulate();
});

function simulate()
{
	_page.clear();

	var statsSimulateEnchantment = makeGroupedCollection( _tools );
	var statsEnchantmentCount = makeCollection( _tools );
	var totalEnchantments = 0;
	var misses = 0;

	var calculateStdDev = function()
	{
		statsEnchantmentCount.updateSum();
		statsSimulateEnchantment.updateSum();
	};

	var collecthelper = function( result )
	{
		statsSimulateEnchantment.report( result.enchantment.id, result.enchantmentLevel );
	};

	var collectStats = function( result )
	{
		totalEnchantments += result.length;
		if( result.length === 0 )
			misses++;
		statsEnchantmentCount.report(result.length);
		_tools.foreach( result, collecthelper )
	};

	var it = makeIterator( simulateEnchantments, collectStats );

	var iterate = function( data )
	{
		it.run( data.iterations, data );
	};

	var sim = makeIterator( iterate, calculateStdDev );



	var data = _page.getInputData();

	var baseLevel = getBaseEnchantmentLevel( data.itemId, data.materialId );

	_page.write( "Base enchantment level for tool: " + baseLevel );

	if( baseLevel <= 0 )
	{
		_page.write( "Not enchantable!" );
		return;
	}

	_page.write( "Simulating enchanting "
		+ data.material + " "
		+ data.item + " " 
		+ data.iterations + " times over " 
		+ data.simulations +" series." );

	sim.run( data.simulations, data );

	_page.write( "Done, presenting data..." );
	if(misses > 0 )
		_page.write ("Missed enchanting " + misses + " times.");
	
	_page.write( "Enchantment count saturation: " + totalEnchantments / (data.simulations*data.iterations) );

	var writeNInfo = function( p,s,label )
	{
		return label + " enchantments: " + _tools.wrapPercent(p,s);
	};

	var nWriter = makeChart( 240, 23, "#num", "white", writeNInfo, data.iterations, data.showstdev, _page );

	statsEnchantmentCount.foreach( nWriter.drawNext );

	_page.write();

	var writeCInfo = function(enchantment,p,s,level)
	{
		return enchantment.name + " " + level + ": " + _tools.wrapPercent( p, s );
	};

	var drawController = makeDrawController( 240, 23, "#sim", writeCInfo, data.iterations, data.showstdev, _page,
		function( enchantment, p )
		{
			_page.write("Total probability for " + enchantment.name + ": " + Math.floor(p*100) + "%" );
		} );

	statsSimulateEnchantment.foreach( drawController );
}

</script>
<style type="text/css">
.textholder, .chartholder
{
border: 1px solid black;
margin: 3em;
padding: 1em;
}
.chartcontainer
{
float:left;
width: 40%;
margin: 2em;
padding: 2em;
}
.textholder
{
	float: right;
	width: 30%;
}
.chartholder
{
	position: relative;
	height: 240px;
	width: 100%;
}

.chartholder div
{
border: 1px solid black;
bottom:1px;
width: 20px;
position:absolute;
}

.debug
{
display:none;
font-size:0.5em;
color: #999;
}
</style>
</head>
<body>
<form>
Material: <select id="material" onchange="simulate()">
<option value="diamond">Diamond</option>
<option value="iron">Iron</option>
<option value="gold">Gold</option>
<option value="leather">Leather</option>
<option value="stone">Stone</option>
<option value="chain">Chainmail</option>
<option value="wood">Wood</option>
</select>
|
Item: <select id="item" onchange="simulate()">
<option value="pickaxe">Pickaxe</option>
<option value="sword">Sword</option>
<option value="axe">Axe</option>
<option value="shovel">Shovel</option>
<option value="helmet">Helmet</option>
<option value="chestplate">Chestplate</option>
<option value="leggings">Leggings</option>
<option value="boots">Boots</option>
<option value="bow">Bow</option>
</select>
|
Level: <input value="30" id="level" onchange="simulate()" />
<input type="button" onclick="_page.addLevel()" value="+"/>
<input type="button" onclick="_page.removeLevel()" value="-" /> |
Simulations: <input id="trials" onchange="simulate()" /> |
Show confidence intervals: <input type="checkbox" id="stdev" onchange="simulate()"/> |
<input type="button" onclick="simulate()" value="Go"/>
</form>
<div class="chartcontainer">

Probability that enchantment will be included:
<div class="chartholder" id="sim"></div>

Probability to get N enchantments:
<div class="chartholder" id="num"></div>

</div>
<div class="textholder" id="output"></div>
</body>
</html>