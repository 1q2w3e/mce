<!DOCTYPE html>
<html>
<head>
<title>Minecraft Enchantment Simulator v1.7.5</title>

<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="js/storage.js"></script>
<script type="text/javascript" src="js/iterator.js"></script>
<script type="text/javascript" src="js/tools.js"></script>
<script type="text/javascript" src="js/collection.js"></script>
<script type="text/javascript" src="js/enchantments.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/chart.js"></script>
<script type="text/javascript" src="js/mc.js"></script>

<script type="text/javascript">
var _storage = makeStorage();
var _tools = makeTools();
var _page = makePage( _storage, _tools );

$(document).ready(function()
{
	$("#add").click( function(){ _page.addLevel(); simulate(); } );
	$("#remove").click( function(){ _page.removeLevel(); simulate(); } );
	$("#runagain").click( function(){ simulate() });
	_page.setInitialValues();
	simulate();
});

function simulate()
{
	_page.clear();

	var statsSimulateEnchantment = makeGroupedCollection( _tools );
	var statsEnchantmentCount = makeCollection( _tools );
	var totalEnchantments = 0;
	var misses = 0;

	var calculateStdDev = function()
	{
		statsEnchantmentCount.updateSum();
		statsSimulateEnchantment.updateSum();
	};

	var collecthelper = function( result )
	{
		statsSimulateEnchantment.report( result.enchantment.id, result.enchantmentLevel );
	};

	var collectStats = function( result )
	{
		totalEnchantments += result.length;
		if( result.length === 0 )
			misses++;
		statsEnchantmentCount.report(result.length);
		_tools.foreach( result, collecthelper )
	};

	var it = makeIterator( simulateEnchantments, collectStats );

	var iterate = function( data )
	{
		it.run( data.iterations, data );
	};

	var sim = makeIterator( iterate, calculateStdDev );



	var data = _page.getInputData();

	var baseLevel = getBaseEnchantmentLevel( data.itemId, data.materialId );

	_page.write("");
	_page.write( "Base enchantment level for tool: " + baseLevel );

	if( baseLevel <= 0 )
	{
		_page.write( "Not enchantable!" );
		return;
	}

	_page.write( "Simulating enchanting "
		+ data.material + " "
		+ data.item + " " 
		+ data.iterations + " times over " 
		+ data.simulations +" series." );

	sim.run( data.simulations, data );

	_page.write( "Done, presenting data..." );
	if(misses > 0 )
		_page.write ("Missed enchanting " + misses + " times.");
	
	_page.write( "Enchantment count saturation: " + totalEnchantments / (data.simulations*data.iterations) );

	var writeNInfo = function( p,s,label )
	{
		return label + " enchantments: " + _tools.wrapPercent(p,s);
	};

	var nWriter = makeChart( 240, 23, "#num", "white", writeNInfo, data.iterations, data.showstdev, _page );

	statsEnchantmentCount.foreach( nWriter.drawNext );

	_page.write();

	var writeCInfo = function(enchantment,p,s,level)
	{
		return enchantment.name + " " + level + ": " + _tools.wrapPercent( p, s );
	};

	var drawController = makeDrawController( 240, 23, "#sim", writeCInfo, data.iterations, data.showstdev, _page,
		function( enchantment, p )
		{
			_page.write("Total prob. for " + enchantment.name + ": " + Math.floor(p*100) + "%" );
		} );

	statsSimulateEnchantment.foreach( drawController );
}

</script>
<style type="text/css">
body
{
	padding-top: 50px;
}

.chartholder
{
	border: 1px solid black;
	position: relative;
	height: 244px;
}
.chartholder div
{
	border: 1px solid black;
	bottom:1px;
	width: 20px;
	position:absolute;
}
</style>
<link href="css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
<div class="navbar navbar-fixed-top">
	<div class="navbar-inner">
		<div class="container">
			<a class="brand" href="#">Minecraft Enchantment Simulator</a>
		</div>
	</div>
</div>
<div class="container">
	<div class="row">
		<div class="span3">
			<form class="well form-inline" action="#">
				<fieldset>
					<legend>Select input</legend>
					<div class="control-group">
						<label class="control-label">Material</label>
						<div class="controls">
							<select id="material" class="span2"  onchange="simulate()">
								<option value="diamond">Diamond</option>
								<option value="iron">Iron</option>
								<option value="gold">Gold</option>
								<option value="leather">Leather</option>
								<option value="stone">Stone</option>
								<option value="chain">Chainmail</option>
								<option value="wood">Wood</option>
							</select>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">Item</label>
						<div class="controls">
							<select id="item" class="span2" onchange="simulate()">
								<option value="pickaxe">Pickaxe</option>
								<option value="sword">Sword</option>
								<option value="axe">Axe</option>
								<option value="shovel">Shovel</option>
								<option value="helmet">Helmet</option>
								<option value="chestplate">Chestplate</option>
								<option value="leggings">Leggings</option>
								<option value="boots">Boots</option>
								<option value="bow">Bow</option>
							</select>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">Level</label>
						<div class="controls">
							<input value="30" id="level" class="span1" onchange="simulate()" />
							<button class="btn" id="add">+</button>
							<button class="btn" id="remove">-</button>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">Simulations</label>
						<div class="controls">
							<input id="trials" class="span2" onchange="simulate()" />
						</div>
					</div>

					<div class="control-group">
						<div class="controls">
							<label class="checkbox">
								<input type="checkbox" id="stdev" onchange="simulate()">
								Show confidence intervals
							</label>
						</div>
					</div>

					<div class="form-actions">
						<button id="runagain" class="btn btn-info">Run again</button>
					</div>
				</fieldset>
			</form>
		</div>
		<div class="span5">
			<div class="row">
				<div class="chartholder span5" id="sim"></div>
			</div>
			<div class="row"><div class="span5"><p>&nbsp;</p></div></div>
			<div class="row">
				<div class="span5">
					<p>Probability that enchantment will be included</p>
				</div>
			</div>
			<div class="row"><div class="span5"><p>&nbsp;</p></div></div>
			<div class="row"><div class="span5"><p>&nbsp;</p></div></div>
			<div class="row">
				<div class="chartholder span5" id="num"></div>
			</div>
			<div class="row"><div class="span5"><p>&nbsp;</p></div></div>
			<div class="row">
				<div class="span5">
					<p>Probability to get N enchantments</p>
				</div>
			</div>
		</div>
		<div class="span3">
			<pre id="output" class="textholder"></pre>
		</div>
	</div>
	<hr/>
	<footer>
		<p>
			This project lives at <a href="http://github.com/zazcallabah/mce">github.com/zazcallabah/mce</a>.<br/>
			<small>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a><br/>
			Made with the help of <a href="http://jquery.com">jQuery 1.7.1</a> and <a href="http://twitter.github.com/bootstrap/">Bootstrap</a>.</small>
		</p>
	</footer>
</div>
</body>
</html>